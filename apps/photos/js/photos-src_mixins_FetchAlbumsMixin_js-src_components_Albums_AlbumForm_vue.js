/*! For license information please see photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.LICENSE.txt */
"use strict";(self.webpackChunkphotos=self.webpackChunkphotos||[]).push([["src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue"],{12945:(n,t,e)=>{e.d(t,{Z:()=>m});var o=e(20629),a=e(45994),r=e(69363),l=e(99622);function i(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function s(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?i(Object(e),!0).forEach((function(t){c(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function c(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function u(n,t,e,o,a,r,l){try{var i=n[r](l),s=i.value}catch(n){return void e(n)}i.done?t(s):Promise.resolve(s).then(o,a)}function b(n){return function(){var t=this,e=arguments;return new Promise((function(o,a){var r=n.apply(t,e);function l(n){u(r,o,a,l,i,"next",n)}function i(n){u(r,o,a,l,i,"throw",n)}l(void 0)}))}}const m={name:"FetchAlbumsMixin",data:function(){return{errorFetchingAlbums:null,loadingAlbums:!1}},mixins:[r.Z],beforeMount:function(){var n=this;return b(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.fetchAlbums();case 1:case"end":return t.stop()}}),t)})))()},computed:s({},(0,o.Se)(["albums"])),methods:s(s({},(0,o.nv)(["addAlbums"])),{},{fetchAlbums:function(){var n=this;return b(regeneratorRuntime.mark((function t(){var e,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.loadingAlbums){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n.loadingAlbums=!0,n.errorFetchingAlbums=null,t.next=7,(0,l.CE)("/photos/".concat(null===(e=(0,a.ts)())||void 0===e?void 0:e.uid,"/albums"),n.abortController.signal);case 7:o=t.sent,n.addAlbums({albums:o}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),404===(null===(r=t.t0.response)||void 0===r?void 0:r.status)?n.errorFetchingAlbums=404:n.errorFetchingAlbums=t.t0;case 14:return t.prev=14,n.loadingAlbums=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,11,14,17]])})))()}})}},62116:(n,t,e)=>{e.d(t,{Z:()=>i});var o=e(87537),a=e.n(o),r=e(23645),l=e.n(r)()(a());l.push([n.id,".album-form[data-v-5bc188a2]{display:flex;flex-direction:column;height:350px;padding:16px}.album-form .form-title[data-v-5bc188a2]{font-weight:bold}.album-form .form-subtitle[data-v-5bc188a2]{color:var(--color-text-lighter)}.album-form .form-inputs[data-v-5bc188a2]{flex-grow:1;justify-items:flex-end}.album-form .form-inputs input[data-v-5bc188a2]{width:100%}.album-form .form-inputs label[data-v-5bc188a2]{display:flex;margin-top:16px}.album-form .form-inputs label[data-v-5bc188a2]  svg{margin-right:12px}.album-form .form-buttons[data-v-5bc188a2]{display:flex;justify-content:space-between}.album-form .form-buttons .left-buttons[data-v-5bc188a2],.album-form .form-buttons .right-buttons[data-v-5bc188a2]{display:flex}.album-form .form-buttons .right-buttons[data-v-5bc188a2]{justify-content:flex-end}.album-form .form-buttons button[data-v-5bc188a2]{margin-right:16px}.left-buttons[data-v-5bc188a2]{flex-grow:1}","",{version:3,sources:["webpack://./src/components/Albums/AlbumForm.vue"],names:[],mappings:"AAoPA,6BACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,yCACC,gBAAA,CAGD,4CACC,+BAAA,CAGD,0CACC,WAAA,CACA,sBAAA,CAEA,gDACC,UAAA,CAGD,gDACC,YAAA,CACA,eAAA,CAEA,qDACC,iBAAA,CAKH,2CACC,YAAA,CACA,6BAAA,CAEA,mHACC,YAAA,CAGD,0DACC,wBAAA,CAGD,kDACC,iBAAA,CAKH,+BACC,WAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.album-form {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 350px;\n\tpadding: 16px;\n\n\t.form-title {\n\t\tfont-weight: bold;\n\t}\n\n\t.form-subtitle {\n\t\tcolor: var(--color-text-lighter);\n\t}\n\n\t.form-inputs {\n\t\tflex-grow: 1;\n\t\tjustify-items: flex-end;\n\n\t\tinput {\n\t\t\twidth: 100%;\n\t\t}\n\n\t\tlabel {\n\t\t\tdisplay: flex;\n\t\t\tmargin-top: 16px;\n\n\t\t\t::v-deep svg {\n\t\t\t\tmargin-right: 12px;\n\t\t\t}\n\t\t}\n\t}\n\n\t.form-buttons {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\n\t\t.left-buttons, .right-buttons {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t.right-buttons {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\n\t\tbutton {\n\t\t\tmargin-right: 16px;\n\t\t}\n\t}\n}\n\n.left-buttons {\n\tflex-grow: 1;\n}\n'],sourceRoot:""}]);const i=l},50253:(n,t,e)=>{e.d(t,{Z:()=>i});var o=e(87537),a=e.n(o),r=e(23645),l=e.n(r)()(a());l.push([n.id,".manage-collaborators[data-v-55e75420]{display:flex;flex-direction:column;padding:20px;height:500px}.manage-collaborators__title[data-v-55e75420]{font-weight:bold}.manage-collaborators__subtitle[data-v-55e75420]{color:var(--color-text-lighter)}.manage-collaborators__public-link-button[data-v-55e75420]{margin:4px 0}.manage-collaborators__form[data-v-55e75420]{margin-top:4px 0;display:flex;flex-direction:column}.manage-collaborators__form__input[data-v-55e75420]{position:relative;display:block}.manage-collaborators__form__input input[data-v-55e75420]{width:100%;padding-left:34px}.manage-collaborators__form__input .loading-icon[data-v-55e75420]{position:absolute;top:8px;right:8px}.manage-collaborators__form__list[data-v-55e75420]{padding:8px;height:500px;overflow:scroll}.manage-collaborators__form__list__result[data-v-55e75420]{padding:8px;border-radius:100px;box-sizing:border-box}.manage-collaborators__form__list__result[data-v-55e75420],.manage-collaborators__form__list__result *[data-v-55e75420]{cursor:pointer !important}.manage-collaborators__form__list__result[data-v-55e75420]:hover{background:var(--color-background-dark)}.manage-collaborators__form__list--empty[data-v-55e75420]{margin:100px 0}.manage-collaborators__selection[data-v-55e75420]{display:flex;flex-direction:column;margin-top:8px;flex-grow:1}.manage-collaborators__selection__item[data-v-55e75420]{border-radius:var(--border-radius-pill);padding:0 8px}.manage-collaborators__selection__item[data-v-55e75420]:hover{background:var(--color-background-dark)}.manage-collaborators .actions[data-v-55e75420]{display:flex;margin-top:8px}.manage-collaborators .actions__public-link[data-v-55e75420]{display:flex;align-items:center}.manage-collaborators .actions__public-link button[data-v-55e75420]{margin-left:8px}.manage-collaborators .actions__slot[data-v-55e75420]{flex-grow:1;display:flex;justify-content:flex-end;align-items:center}","",{version:3,sources:["webpack://./src/components/Albums/CollaboratorsSelectionForm.vue"],names:[],mappings:"AAyaA,uCACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,8CACC,gBAAA,CAGD,iDACC,+BAAA,CAGD,2DACC,YAAA,CAGD,6CACC,gBAAA,CACA,YAAA,CACA,qBAAA,CAEA,oDACC,iBAAA,CACA,aAAA,CAEA,0DACC,UAAA,CACA,iBAAA,CAGD,kEACC,iBAAA,CACA,OAAA,CACA,SAAA,CAIF,mDACC,WAAA,CACA,YAAA,CACA,eAAA,CACA,2DACC,WAAA,CACA,mBAAA,CACA,qBAAA,CAEA,wHACC,yBAAA,CAGD,iEACC,uCAAA,CAIF,0DACC,cAAA,CAKH,kDACC,YAAA,CACA,qBAAA,CACA,cAAA,CACA,WAAA,CAEA,wDACC,uCAAA,CACA,aAAA,CAEA,8DACC,uCAAA,CAKH,gDACC,YAAA,CACA,cAAA,CAEA,6DACC,YAAA,CACA,kBAAA,CAEA,oEACC,eAAA,CAIF,sDACC,WAAA,CACA,YAAA,CACA,wBAAA,CACA,kBAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.manage-collaborators {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 20px;\n\theight: 500px;\n\n\t&__title {\n\t\tfont-weight: bold;\n\t}\n\n\t&__subtitle {\n\t\tcolor: var(--color-text-lighter);\n\t}\n\n\t&__public-link-button {\n\t\tmargin: 4px 0;\n\t}\n\n\t&__form {\n\t\tmargin-top: 4px 0;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\n\t\t&__input {\n\t\t\tposition: relative;\n\t\t\tdisplay: block;\n\n\t\t\tinput {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding-left: 34px;\n\t\t\t}\n\n\t\t\t.loading-icon {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: calc(36px / 2 - 20px / 2);\n\t\t\t\tright: 8px;\n\t\t\t}\n\t\t}\n\n\t\t&__list {\n\t\t\tpadding: 8px;\n\t\t\theight: 500px;\n\t\t\toverflow: scroll;\n\t\t\t&__result {\n\t\t\t\tpadding: 8px;\n\t\t\t\tborder-radius: 100px;\n\t\t\t\tbox-sizing: border-box;\n\n\t\t\t\t&, & * {\n\t\t\t\t\tcursor: pointer !important;\n\t\t\t\t}\n\n\t\t\t\t&:hover {\n\t\t\t\t\tbackground: var(--color-background-dark);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t&--empty {\n\t\t\t\tmargin: 100px 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t&__selection {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmargin-top: 8px;\n\t\tflex-grow: 1;\n\n\t\t&__item {\n\t\t\tborder-radius: var(--border-radius-pill);\n\t\t\tpadding:  0 8px;\n\n\t\t\t&:hover {\n\t\t\t\tbackground: var(--color-background-dark);\n\t\t\t}\n\t\t}\n\t}\n\n\t.actions {\n\t\tdisplay: flex;\n\t\tmargin-top: 8px;\n\n\t\t&__public-link {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\n\t\t\tbutton {\n\t\t\t\tmargin-left: 8px;\n\t\t\t}\n\t\t}\n\n\t\t&__slot {\n\t\t\tflex-grow: 1;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: flex-end;\n\t\t\talign-items: center;\n\t\t}\n\t}\n}\n'],sourceRoot:""}]);const i=l},59008:(n,t,e)=>{e.d(t,{Z:()=>D});var o=e(20629),a=e(93050),r=e(94878),l=e(75400),i=e(45994),s=e(33476),c=e(80351),u=e.n(c),b=e(11736);function m(n,t,e,o,a,r,l){try{var i=n[r](l),s=i.value}catch(n){return void e(n)}i.done?t(s):Promise.resolve(s).then(o,a)}function p(n){return function(){var t=this,e=arguments;return new Promise((function(o,a){var r=n.apply(t,e);function l(n){m(r,o,a,l,i,"next",n)}function i(n){m(r,o,a,l,i,"throw",n)}l(void 0)}))}}function d(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function A(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){f(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function f(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}const g={name:"AlbumForm",components:{MapMarker:a.Z,AccountMultiplePlus:r.Z,Send:l.Z,NcButton:s.NcButton,NcLoadingIcon:s.NcLoadingIcon,NcTextField:s.NcTextField,CollaboratorsSelectionForm:b.Z},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data:function(){return{showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}},computed:{editMode:function(){return null!==this.album},sharingEnabled:function(){return void 0!==OC.Share}},mounted:function(){var n=this;this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location),this.$nextTick((function(){n.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()}))},methods:A(A({},(0,o.nv)(["createAlbum","renameAlbum","updateAlbum"])),{},{submit:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];""===this.albumName||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(n))},handleCreateAlbum:function(){var n=arguments,t=this;return p(regeneratorRuntime.mark((function e(){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.length>0&&void 0!==n[0]?n[0]:[],e.prev=1,t.loading=!0,e.next=5,t.createAlbum({album:{basename:t.albumName,filename:"/photos/".concat((0,i.ts)().uid,"/albums/").concat(t.albumName),nbItems:0,location:t.albumLocation,lastPhoto:-1,date:u()().format("MMMM YYYY"),collaborators:o}});case 5:if(a=e.sent,""===t.albumLocation&&0===o.length){e.next=10;break}return e.next=9,t.updateAlbum({albumName:t.albumName,properties:{location:t.albumLocation,collaborators:o}});case 9:a=e.sent;case 10:t.$emit("done",{album:a});case 11:return e.prev=11,t.loading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})))()},handleUpdateAlbum:function(){var n=this;return p(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n.loading=!0,e=A({},n.album),n.album.basename===n.albumName){t.next=7;break}return t.next=6,n.renameAlbum({currentAlbumName:n.album.basename,newAlbumName:n.albumName});case 6:e=t.sent;case 7:if(n.album.location===n.albumLocation){t.next=11;break}return t.next=10,n.updateAlbum({albumName:n.albumName,properties:{location:n.albumLocation}});case 10:e.location=t.sent;case 11:n.$emit("done",{album:e});case 12:return t.prev=12,n.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,,12,15]])})))()},back:function(){this.$emit("back")}})};var C=e(93379),h=e.n(C),v=e(7795),_=e.n(v),y=e(90569),x=e.n(y),k=e(3565),w=e.n(k),E=e(19216),N=e.n(E),P=e(44589),O=e.n(P),S=e(62116),L={};L.styleTagTransform=O(),L.setAttributes=w(),L.insert=x().bind(null,"head"),L.domAPI=_(),L.insertStyleElement=N();h()(S.Z,L);S.Z&&S.Z.locals&&S.Z.locals;const D=(0,e(51900).Z)(g,(function(){var n=this,t=n.$createElement,e=n._self._c||t;return n.showCollaboratorView?e("CollaboratorsSelectionForm",{attrs:{"album-name":n.albumName,"allow-public-link":!1},scopedSlots:n._u([{key:"default",fn:function(t){var o=t.collaborators;return[e("span",{staticClass:"left-buttons"},[e("NcButton",{attrs:{"aria-label":n.t("photos","Back to the new album form."),type:"tertiary"},on:{click:function(t){n.showCollaboratorView=!1}}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")])],1),n._v(" "),e("span",{staticClass:"right-buttons"},[e("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){return n.submit(o)}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?e("NcLoadingIcon"):e("Send")]},proxy:!0}],null,!0)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)]}}])}):e("form",{staticClass:"album-form",on:{submit:function(t){return t.preventDefault(),n.submit.apply(null,arguments)}}},[e("div",{staticClass:"form-inputs"},[e("NcTextField",{ref:"nameInput",attrs:{value:n.albumName,type:"text",name:"name",required:!0,autofocus:"true",placeholder:n.t("photos","Name of the album")},on:{"update:value":function(t){n.albumName=t}}}),n._v(" "),e("label",[e("MapMarker"),e("NcTextField",{attrs:{value:n.albumLocation,name:"location",type:"text",placeholder:n.t("photos","Location of the album")},on:{"update:value":function(t){n.albumLocation=t}}})],1)],1),n._v(" "),e("div",{staticClass:"form-buttons"},[e("span",{staticClass:"left-buttons"},[n.displayBackButton?e("NcButton",{attrs:{"aria-label":n.t("photos","Go back to the previous view."),type:"tertiary"},on:{click:n.back}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")]):n._e()],1),n._v(" "),e("span",{staticClass:"right-buttons"},[n.sharingEnabled&&!n.editMode?e("NcButton",{attrs:{"aria-label":n.t("photos","Go to the add collaborators view."),type:"secondary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){n.showCollaboratorView=!0}},scopedSlots:n._u([{key:"icon",fn:function(){return[e("AccountMultiplePlus")]},proxy:!0}],null,!1,1531126728)},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t\t\t")]):n._e(),n._v(" "),e("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName||n.loading},on:{click:function(t){return n.submit()}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?e("NcLoadingIcon"):e("Send")]},proxy:!0}],null,!1,3914512768)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)])])}),[],!1,null,"5bc188a2",null).exports},11736:(n,e,o)=>{o.d(e,{Z:()=>Z});var a=o(20629),r=o(38530),l=o(31894),i=o(14625),s=o(47987),c=o(86472),u=o(55683),b=o(26937),m=o(82880),p=o(45994),d=o(79753),A=o(33476),f=o(41922),g=o(59537),C=o(69363),h=o(99622);function v(n,t,e,o,a,r,l){try{var i=n[r](l),s=i.value}catch(n){return void e(n)}i.done?t(s):Promise.resolve(s).then(o,a)}function _(n){return function(){var t=this,e=arguments;return new Promise((function(o,a){var r=n.apply(t,e);function l(n){v(r,o,a,l,i,"next",n)}function i(n){v(r,o,a,l,i,"throw",n)}l(void 0)}))}}function y(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function x(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?y(Object(e),!0).forEach((function(t){k(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):y(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function k(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}const w={name:"CollaboratorsSelectionForm",components:{Magnify:r.Z,Close:l.default,AccountGroup:c.Z,ContentCopy:s.Z,Check:i.default,Earth:u.Z,NcLoadingIcon:A.NcLoadingIcon,NcButton:A.NcButton,NcListItemIcon:A.NcListItemIcon,NcTextField:A.NcTextField,NcPopover:A.NcPopover,NcEmptyContent:A.NcEmptyContent},mixins:[C.Z],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:function(){return[]}},allowPublicLink:{type:Boolean,default:!0}},data:function(){return{searchText:"",availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingAlbum:!1,errorFetchingAlbum:null,loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}},computed:{searchResults:function(){var n=this;return this.currentSearchResults.filter((function(n){return n.id!==(0,p.ts)().uid})).map((function(n){var t=n.type,e=n.id;return"".concat(t,":").concat(e)})).filter((function(t){return!n.selectedCollaboratorsKeys.includes(t)}))},listableSelectedCollaboratorsKeys:function(){var n=this;return this.selectedCollaboratorsKeys.filter((function(t){return n.availableCollaborators[t].type!==f.D.SHARE_TYPE_LINK}))},selectedCollaborators:function(){var n=this;return this.selectedCollaboratorsKeys.map((function(t){return n.availableCollaborators[t]}))},isPublicLinkSelected:function(){return this.selectedCollaboratorsKeys.includes("".concat(f.D.SHARE_TYPE_LINK))},publicLink:function(){return this.availableCollaborators[f.D.SHARE_TYPE_LINK]}},watch:{collaborators:function(n){this.populateCollaborators(n)}},mounted:function(){this.searchCollaborators(),this.populateCollaborators(this.collaborators)},methods:x(x({},(0,a.nv)(["updateAlbum","addAlbums"])),{},{searchCollaborators:function(){var n=this;return _(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n.searchText.length<n.config.minSearchStringLength)){e.next=3;break}return e.abrupt("return");case 3:return n.loadingCollaborators=!0,e.next=6,b.Z.get((0,d.generateOcsUrl)("core/autocomplete/get"),{params:{search:n.searchText,itemType:"share-recipients",shareTypes:[f.D.SHARE_TYPE_USER,f.D.SHARE_TYPE_GROUP]}});case 6:o=e.sent,n.currentSearchResults=o.data.ocs.data.map((function(n){switch(n.source){case"users":return{id:n.id,label:n.label,type:f.D.SHARE_TYPE_USER};case"groups":return{id:n.id,label:n.label,type:f.D.SHARE_TYPE_GROUP};default:throw new Error("Invalid collaborator source ".concat(n.source))}})),n.availableCollaborators=x(x({},n.availableCollaborators),n.currentSearchResults.reduce(n.indexCollaborators,{})),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),n.errorFetchingCollaborators=e.t0,g.Z.error(t("photos","Failed to fetch collaborators list."),e.t0),(0,m.showError)(t("photos","Failed to fetch collaborators list."));case 16:return e.prev=16,n.loadingCollaborators=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,11,16,19]])})))()},populateCollaborators:function(n){var e=n.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(e),this.availableCollaborators=x(x({3:{id:"",label:t("photos","Public link"),type:f.D.SHARE_TYPE_LINK}},this.availableCollaborators),e)},indexCollaborators:function(n,t){return x(x({},n),{},k({},"".concat(t.type).concat(t.type===f.D.SHARE_TYPE_LINK?"":":").concat(t.type===f.D.SHARE_TYPE_LINK?"":t.id),t))},createPublicLinkForAlbum:function(){var n=this;return _(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.selectEntity("".concat(f.D.SHARE_TYPE_LINK)),t.next=3,n.updateAlbumCollaborators();case 3:return t.prev=3,n.loadingAlbum=!0,n.errorFetchingAlbum=null,t.next=8,(0,h.Lz)("/photos/".concat((0,p.ts)().uid,"/albums/").concat(n.albumName),{signal:n.abortController.signal});case 8:e=t.sent,n.addAlbums({albums:[e]}),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(3),404===(null===(o=t.t0.response)||void 0===o?void 0:o.status)?n.errorFetchingAlbum=404:n.errorFetchingAlbum=t.t0,g.Z.error("[PublicAlbumContent] Error fetching album",{error:t.t0}),(0,m.showError)(n.t("photos","Failed to fetch album."));case 17:return t.prev=17,n.loadingAlbum=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,12,17,20]])})))()},deletePublicLink:function(){var n=this;return _(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.unselectEntity("".concat(f.D.SHARE_TYPE_LINK)),n.availableCollaborators[3]={id:"",label:t("photos","Public link"),type:f.D.SHARE_TYPE_LINK},n.publicLinkCopied=!1,e.next=5,n.updateAlbumCollaborators();case 5:case"end":return e.stop()}}),e)})))()},updateAlbumCollaborators:function(){var n=this;return _(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.updateAlbum({albumName:n.albumName,properties:{collaborators:n.selectedCollaborators}});case 3:t.next=9;break;case 5:t.prev=5,t.t0=t.catch(0),g.Z.error("[PublicAlbumContent] Error updating album",{error:t.t0}),(0,m.showError)(n.t("photos","Failed to update album."));case 9:return t.prev=9,n.loadingAlbum=!1,t.finish(9);case 12:case"end":return t.stop()}}),t,null,[[0,5,9,12]])})))()},copyPublicLink:function(){var n=this;return _(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText("".concat(window.location.protocol,"//").concat(window.location.host).concat((0,d.generateUrl)("apps/photos/public/".concat(n.publicLink.id))));case 2:n.publicLinkCopied=!0,setTimeout((function(){n.publicLinkCopied=!1}),1e4);case 4:case"end":return t.stop()}}),t)})))()},selectEntity:function(n){this.selectedCollaboratorsKeys.includes(n)||(this.$refs.popover.$refs.popover.hide(),this.selectedCollaboratorsKeys.push(n))},unselectEntity:function(n){var t=this.selectedCollaboratorsKeys.indexOf(n);-1!==t&&this.selectedCollaboratorsKeys.splice(t,1)}})};var E=o(93379),N=o.n(E),P=o(7795),O=o.n(P),S=o(90569),L=o.n(S),D=o(3565),T=o.n(D),B=o(19216),j=o.n(B),R=o(44589),I=o.n(R),F=o(50253),Y={};Y.styleTagTransform=I(),Y.setAttributes=T(),Y.insert=L().bind(null,"head"),Y.domAPI=O(),Y.insertStyleElement=j();N()(F.Z,Y);F.Z&&F.Z.locals&&F.Z.locals;const Z=(0,o(51900).Z)(w,(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"manage-collaborators"},[e("h2",{staticClass:"manage-collaborators__title"},[n._v("\n\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t")]),n._v(" "),e("div",{staticClass:"manage-collaborators__subtitle"},[n._v("\n\t\t"+n._s(n.t("photos","Add people or groups who can edit your album"))+"\n\t")]),n._v(" "),e("form",{staticClass:"manage-collaborators__form",on:{submit:function(n){n.preventDefault()}}},[e("NcPopover",{ref:"popover",attrs:{"auto-size":!0,distance:0}},[e("label",{staticClass:"manage-collaborators__form__input",attrs:{slot:"trigger"},slot:"trigger"},[e("NcTextField",{attrs:{value:n.searchText,autocomplete:"off",type:"search",name:"search","aria-label":n.t("photos","Search for collaborators"),"aria-autocomplete":"list","aria-controls":"manage-collaborators__form__selection-"+n.randomId+" manage-collaborators__form__list-"+n.randomId,placeholder:n.t("photos","Search people or groups")},on:{"update:value":function(t){n.searchText=t},input:n.searchCollaborators}},[e("Magnify",{attrs:{size:16}})],1),n._v(" "),n.loadingCollaborators?e("NcLoadingIcon"):n._e()],1),n._v(" "),0!==n.searchResults.length?e("ul",{staticClass:"manage-collaborators__form__list",attrs:{id:"manage-collaborators__form__list-"+n.randomId}},n._l(n.searchResults,(function(t){return e("li",{key:t},[e("a",[e("NcListItemIcon",{staticClass:"manage-collaborators__form__list__result",attrs:{id:n.availableCollaborators[t].id,title:n.availableCollaborators[t].id,search:n.searchText,user:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,"aria-label":n.t("photos","Add {collaboratorLabel} to the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label})},on:{click:function(e){return n.selectEntity(t)}}})],1)])})),0):e("NcEmptyContent",{key:"emptycontent",staticClass:"manage-collaborators__form__list--empty",attrs:{title:n.t("photos","No collaborators available")}},[e("AccountGroup",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1),n._v(" "),e("ul",{staticClass:"manage-collaborators__selection"},n._l(n.listableSelectedCollaboratorsKeys,(function(t){return e("li",{key:t,staticClass:"manage-collaborators__selection__item"},[e("NcListItemIcon",{attrs:{id:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,title:n.availableCollaborators[t].id,user:n.availableCollaborators[t].id}},[e("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label})},on:{click:function(e){return n.unselectEntity(t)}}},[e("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)})),0),n._v(" "),e("div",{staticClass:"actions"},[n.allowPublicLink?e("div",{staticClass:"actions__public-link"},[n.isPublicLinkSelected?[e("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":n.t("photos","Copy the public link"),disabled:""===n.publicLink.id},on:{click:n.copyPublicLink},scopedSlots:n._u([{key:"icon",fn:function(){return[n.publicLinkCopied?e("Check"):e("ContentCopy")]},proxy:!0}],null,!1,845538853)},[n.publicLinkCopied?[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Public link copied!"))+"\n\t\t\t\t\t")]:[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Copy public link"))+"\n\t\t\t\t\t")]],2),n._v(" "),e("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Delete the public link"),disabled:""===n.publicLink.id},on:{click:n.deletePublicLink}},[""===n.publicLink.id?e("NcLoadingIcon",{attrs:{slot:"icon"},slot:"icon"}):e("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:e("NcButton",{staticClass:"manage-collaborators__public-link-button",on:{click:n.createPublicLinkForAlbum}},[e("Earth",{attrs:{slot:"icon"},slot:"icon"}),n._v("\n\t\t\t\t"+n._s(n.t("photos","Share via public link"))+"\n\t\t\t")],1)],2):n._e(),n._v(" "),e("div",{staticClass:"actions__slot"},[n._t("default",null,{collaborators:n.selectedCollaborators})],2)])])}),[],!1,null,"55e75420",null).exports}}]);
//# sourceMappingURL=photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.map?v=3d3de89124bb1801b0b3
{"version":3,"file":"photos-src_views_SharedAlbumContent_vue.js?v=953a955b71fe7f4ffed2","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC1ZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;ACvCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=script&lang=js&","webpack:///photos/src/mixins/FetchSharedAlbumsMixin.js","webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true&","webpack://photos/./src/views/SharedAlbumContent.vue?2752","webpack:///photos/src/views/SharedAlbumContent.vue","webpack://photos/./src/views/SharedAlbumContent.vue?e1f0","webpack://photos/./src/views/SharedAlbumContent.vue?c60e","webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true&","webpack://photos/./src/views/SharedAlbumContent.vue?bfec"],"sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapActions, mapGetters } from 'vuex';\nimport MapMarker from 'vue-material-design-icons/MapMarker';\nimport Plus from 'vue-material-design-icons/Plus';\nimport Delete from 'vue-material-design-icons/Delete';\nimport ImagePlus from 'vue-material-design-icons/ImagePlus';\nimport Close from 'vue-material-design-icons/Close'; // import Download from 'vue-material-design-icons/Download'\n// import DownloadMultiple from 'vue-material-design-icons/DownloadMultiple'\n\nimport { NcActions, NcActionButton, NcButton, NcModal, NcEmptyContent, NcActionSeparator, NcUserBubble, isMobile } from '@nextcloud/vue';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport FetchSharedAlbumsMixin from '../mixins/FetchSharedAlbumsMixin.js';\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js';\nimport AbortControllerMixin from '../mixins/AbortControllerMixin.js';\nimport CollectionContent from '../components/Collection/CollectionContent.vue';\nimport HeaderNavigation from '../components/HeaderNavigation.vue'; // import ActionDownload from '../components/Actions/ActionDownload.vue'\n\nimport FilesPicker from '../components/FilesPicker.vue';\nimport logger from '../services/logger.js';\nimport client from '../services/DavClient.js';\nimport DavRequest from '../services/DavRequest.js';\nimport { genFileInfo } from '../utils/fileUtils.js';\nimport { translate } from '@nextcloud/l10n';\nexport default {\n  name: 'SharedAlbumContent',\n  components: {\n    MapMarker: MapMarker,\n    Plus: Plus,\n    Close: Close,\n    // Download,\n    // DownloadMultiple,\n    Delete: Delete,\n    ImagePlus: ImagePlus,\n    NcEmptyContent: NcEmptyContent,\n    NcActions: NcActions,\n    NcActionButton: NcActionButton,\n    NcActionSeparator: NcActionSeparator,\n    NcButton: NcButton,\n    NcModal: NcModal,\n    NcUserBubble: NcUserBubble,\n    CollectionContent: CollectionContent,\n    // ActionDownload,\n    FilesPicker: FilesPicker,\n    HeaderNavigation: HeaderNavigation\n  },\n  mixins: [FetchSharedAlbumsMixin, FetchFilesMixin, AbortControllerMixin, isMobile],\n  props: {\n    albumName: {\n      type: String,\n      default: '/'\n    }\n  },\n  data: function data() {\n    return {\n      showAddPhotosModal: false,\n      loadingCount: 0,\n      loadingAddFilesToAlbum: false\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['files', 'sharedAlbumsFiles'])), {}, {\n    /**\n     * @return {object} The album information for the current albumName.\n     */\n    album: function album() {\n      return this.sharedAlbums[this.albumName] || {};\n    },\n\n    /**\n     * @return {string[]} The list of files for the current albumName.\n     */\n    albumFileIds: function albumFileIds() {\n      return this.sharedAlbumsFiles[this.albumName] || [];\n    },\n\n    /**\n     * @return {string} The album name without the userId between parentheses.\n     */\n    albumOriginalName: function albumOriginalName() {\n      return this.albumName.replace(new RegExp(\"\\\\(\".concat(this.album.collaborators[0].id, \"\\\\)$\")), '');\n    }\n  }),\n  watch: {\n    album: function album() {\n      this.fetchAlbumContent();\n    }\n  },\n  methods: _objectSpread(_objectSpread({}, mapActions(['appendFiles', 'deleteSharedAlbum', 'addFilesToSharedAlbum', 'removeFilesFromSharedAlbum'])), {}, {\n    fetchAlbumContent: function fetchAlbumContent() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var semaphoreSymbol, fetchSemaphoreSymbol, _getCurrentUser, response, fetchedFiles, fileIds, _error$response;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(_this.loadingFiles || _this.showEditAlbumForm)) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", []);\n\n              case 2:\n                _context.next = 4;\n                return _this.semaphore.acquire(function () {\n                  return 0;\n                }, 'fetchFiles');\n\n              case 4:\n                semaphoreSymbol = _context.sent;\n                _context.next = 7;\n                return _this.fetchSemaphore.acquire();\n\n              case 7:\n                fetchSemaphoreSymbol = _context.sent;\n                _context.prev = 8;\n                _this.errorFetchingFiles = null;\n                _this.loadingFiles = true;\n                _this.semaphoreSymbol = semaphoreSymbol;\n                _context.next = 14;\n                return client.getDirectoryContents(\"/photos/\".concat((_getCurrentUser = getCurrentUser()) === null || _getCurrentUser === void 0 ? void 0 : _getCurrentUser.uid, \"/sharedalbums/\").concat(_this.albumName), {\n                  data: DavRequest,\n                  details: true,\n                  signal: _this.abortController.signal\n                });\n\n              case 14:\n                response = _context.sent;\n                fetchedFiles = response.data.map(function (file) {\n                  return genFileInfo(file);\n                });\n                fileIds = fetchedFiles.map(function (file) {\n                  return file.fileid;\n                }).map(function (fileId) {\n                  return fileId.toString();\n                });\n\n                _this.appendFiles(fetchedFiles);\n\n                if (!(fetchedFiles.length > 0)) {\n                  _context.next = 21;\n                  break;\n                }\n\n                _context.next = 21;\n                return _this.$store.commit('addFilesToSharedAlbum', {\n                  albumName: _this.albumName,\n                  fileIdsToAdd: fileIds\n                });\n\n              case 21:\n                logger.debug(\"[SharedAlbumContent] Fetched \".concat(fileIds.length, \" new files: \"), fileIds);\n                _context.next = 36;\n                break;\n\n              case 24:\n                _context.prev = 24;\n                _context.t0 = _context[\"catch\"](8);\n\n                if (!(((_error$response = _context.t0.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 404)) {\n                  _context.next = 30;\n                  break;\n                }\n\n                _this.errorFetchingFiles = 404;\n                _context.next = 35;\n                break;\n\n              case 30:\n                if (!(_context.t0.code === 'ERR_CANCELED')) {\n                  _context.next = 34;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 34:\n                _this.errorFetchingFiles = _context.t0;\n\n              case 35:\n                // cancelled request, moving on...\n                logger.error('[SharedAlbumContent] Error fetching album files', {\n                  error: _context.t0\n                });\n\n              case 36:\n                _context.prev = 36;\n                _this.loadingFiles = false;\n\n                _this.semaphore.release(semaphoreSymbol);\n\n                _this.fetchSemaphore.release(fetchSemaphoreSymbol);\n\n                return _context.finish(36);\n\n              case 41:\n                return _context.abrupt(\"return\", []);\n\n              case 42:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[8, 24, 36, 41]]);\n      }))();\n    },\n    handleFilesPicked: function handleFilesPicked(fileIds) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this2.showAddPhotosModal = false;\n                _context2.next = 3;\n                return _this2.addFilesToSharedAlbum({\n                  albumName: _this2.albumName,\n                  fileIdsToAdd: fileIds\n                });\n\n              case 3:\n                _context2.next = 5;\n                return _this2.fetchAlbumContent();\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    handleRemoveFilesFromAlbum: function handleRemoveFilesFromAlbum(fileIds) {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this3.$refs.collectionContent.onUncheckFiles(fileIds);\n\n                _context3.next = 3;\n                return _this3.removeFilesFromSharedAlbum({\n                  albumName: _this3.albumName,\n                  fileIdsToRemove: fileIds\n                });\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    handleDeleteAlbum: function handleDeleteAlbum() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return _this4.deleteSharedAlbum({\n                  albumName: _this4.albumName\n                });\n\n              case 2:\n                _this4.$router.push('/sharedalbums');\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    },\n    t: translate\n  })\n};","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { mapGetters, mapActions } from 'vuex';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport AbortControllerMixin from './AbortControllerMixin.js';\nimport { fetchAlbums as _fetchAlbums } from '../services/Albums.js';\nexport default {\n  name: 'FetchSharedAlbumsMixin',\n  data: function data() {\n    return {\n      errorFetchingAlbums: null,\n      loadingAlbums: false\n    };\n  },\n  mixins: [AbortControllerMixin],\n  beforeMount: function beforeMount() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.fetchAlbums();\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  computed: _objectSpread({}, mapGetters(['sharedAlbums'])),\n  methods: _objectSpread(_objectSpread({}, mapActions(['addSharedAlbums'])), {}, {\n    fetchAlbums: function fetchAlbums() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _getCurrentUser, albums, _error$response;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!_this2.loadingAlbums) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                _context2.prev = 2;\n                _this2.loadingAlbums = true;\n                _this2.errorFetchingAlbums = null;\n                _context2.next = 7;\n                return _fetchAlbums(\"/photos/\".concat((_getCurrentUser = getCurrentUser()) === null || _getCurrentUser === void 0 ? void 0 : _getCurrentUser.uid, \"/sharedalbums\"), _this2.abortController.signal);\n\n              case 7:\n                albums = _context2.sent;\n\n                _this2.addSharedAlbums({\n                  albums: albums\n                });\n\n                _context2.next = 14;\n                break;\n\n              case 11:\n                _context2.prev = 11;\n                _context2.t0 = _context2[\"catch\"](2);\n\n                if (((_error$response = _context2.t0.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 404) {\n                  _this2.errorFetchingAlbums = 404;\n                } else {\n                  _this2.errorFetchingAlbums = _context2.t0;\n                }\n\n              case 14:\n                _context2.prev = 14;\n                _this2.loadingAlbums = false;\n                return _context2.finish(14);\n\n              case 17:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[2, 11, 14, 17]]);\n      }))();\n    }\n  })\n};","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".album[data-v-259e376e] {\\n  display: flex;\\n  flex-direction: column;\\n}\\n.album__title[data-v-259e376e] {\\n  width: 100%;\\n}\\n.album__name[data-v-259e376e] {\\n  overflow: hidden;\\n  white-space: nowrap;\\n  text-overflow: ellipsis;\\n}\\n.album__location[data-v-259e376e] {\\n  margin-left: -4px;\\n  display: flex;\\n  color: var(--color-text-lighter);\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true&\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true&\"\nimport script from \"./SharedAlbumContent.vue?vue&type=script&lang=js&\"\nexport * from \"./SharedAlbumContent.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"259e376e\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/louis/workspace/nextcloud/apps/photos/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('259e376e')) {\n      api.createRecord('259e376e', component.options)\n    } else {\n      api.reload('259e376e', component.options)\n    }\n    module.hot.accept(\"./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true&\", function () {\n      api.rerender('259e376e', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/SharedAlbumContent.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/style-loader/dist/cjs.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true&\"","export * from \"-!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true&\"","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    [\n      true\n        ? _c(\n            \"CollectionContent\",\n            {\n              ref: \"collectionContent\",\n              attrs: {\n                collection: _vm.album,\n                \"collection-file-ids\": _vm.albumFileIds,\n                semaphore: _vm.semaphore,\n                loading: _vm.loadingAlbums || _vm.loadingFiles,\n                error: _vm.errorFetchingAlbums || _vm.errorFetchingFiles,\n              },\n              scopedSlots: _vm._u(\n                [\n                  {\n                    key: \"header\",\n                    fn: function (ref) {\n                      var selectedFileIds = ref.selectedFileIds\n                      return _c(\n                        \"HeaderNavigation\",\n                        {\n                          key: \"navigation\",\n                          attrs: {\n                            loading: _vm.loadingFiles,\n                            params: { albumName: _vm.albumName },\n                            path: \"/\" + _vm.albumName,\n                            title: _vm.albumOriginalName,\n                          },\n                          on: { refresh: _vm.fetchAlbumContent },\n                        },\n                        [\n                          _vm.album.location !== \"\"\n                            ? _c(\n                                \"div\",\n                                {\n                                  staticClass: \"album__location\",\n                                  attrs: { slot: \"subtitle\" },\n                                  slot: \"subtitle\",\n                                },\n                                [\n                                  _c(\"MapMarker\"),\n                                  _vm._v(\n                                    _vm._s(_vm.album.location) +\n                                      \" ⸱ \" +\n                                      _vm._s(_vm.t(\"photos\", \"Shared by\")) +\n                                      \" \"\n                                  ),\n                                  _c(\"NcUserBubble\", {\n                                    attrs: {\n                                      \"display-name\":\n                                        _vm.album.collaborators[0].label,\n                                      user: _vm.album.collaborators[0].id,\n                                    },\n                                  }),\n                                ],\n                                1\n                              )\n                            : _vm._e(),\n                          _vm._v(\" \"),\n                          _vm.album !== undefined\n                            ? _c(\n                                \"template\",\n                                { slot: \"right\" },\n                                [\n                                  _vm.album.nbItems !== 0\n                                    ? _c(\n                                        \"NcButton\",\n                                        {\n                                          attrs: {\n                                            type: \"tertiary\",\n                                            \"aria-label\": _vm.t(\n                                              \"photos\",\n                                              \"Add photos to this album\"\n                                            ),\n                                          },\n                                          on: {\n                                            click: function ($event) {\n                                              _vm.showAddPhotosModal = true\n                                            },\n                                          },\n                                        },\n                                        [\n                                          _c(\"Plus\", {\n                                            attrs: { slot: \"icon\" },\n                                            slot: \"icon\",\n                                          }),\n                                        ],\n                                        1\n                                      )\n                                    : _vm._e(),\n                                  _vm._v(\" \"),\n                                  _c(\n                                    \"NcActions\",\n                                    {\n                                      attrs: {\n                                        \"force-menu\": true,\n                                        \"aria-label\": _vm.t(\n                                          \"photos\",\n                                          \"Open actions menu\"\n                                        ),\n                                      },\n                                    },\n                                    [\n                                      _c(\n                                        \"NcActionButton\",\n                                        {\n                                          attrs: { \"close-after-click\": true },\n                                          on: { click: _vm.handleDeleteAlbum },\n                                        },\n                                        [\n                                          _vm._v(\n                                            \"\\n\\t\\t\\t\\t\\t\\t\" +\n                                              _vm._s(\n                                                _vm.t(\"photos\", \"Delete album\")\n                                              ) +\n                                              \"\\n\\t\\t\\t\\t\\t\\t\"\n                                          ),\n                                          _c(\"Delete\", {\n                                            attrs: { slot: \"icon\" },\n                                            slot: \"icon\",\n                                          }),\n                                        ],\n                                        1\n                                      ),\n                                      _vm._v(\" \"),\n                                      selectedFileIds.length > 0\n                                        ? [\n                                            _c(\"NcActionSeparator\"),\n                                            _vm._v(\" \"),\n                                            _c(\n                                              \"NcActionButton\",\n                                              {\n                                                attrs: {\n                                                  \"close-after-click\": true,\n                                                },\n                                                on: {\n                                                  click: function ($event) {\n                                                    return _vm.handleRemoveFilesFromAlbum(\n                                                      selectedFileIds\n                                                    )\n                                                  },\n                                                },\n                                              },\n                                              [\n                                                _vm._v(\n                                                  \"\\n\\t\\t\\t\\t\\t\\t\\t\" +\n                                                    _vm._s(\n                                                      _vm.t(\n                                                        \"photos\",\n                                                        \"Remove selection from album\"\n                                                      )\n                                                    ) +\n                                                    \"\\n\\t\\t\\t\\t\\t\\t\\t\"\n                                                ),\n                                                _c(\"Close\", {\n                                                  attrs: { slot: \"icon\" },\n                                                  slot: \"icon\",\n                                                }),\n                                              ],\n                                              1\n                                            ),\n                                          ]\n                                        : _vm._e(),\n                                    ],\n                                    2\n                                  ),\n                                ],\n                                1\n                              )\n                            : _vm._e(),\n                        ],\n                        2\n                      )\n                    },\n                  },\n                ],\n                null,\n                false,\n                327359241\n              ),\n            },\n            [\n              _vm._v(\" \"),\n              _c(\n                \"NcEmptyContent\",\n                {\n                  staticClass: \"album__empty\",\n                  attrs: {\n                    slot: \"empty-content\",\n                    title: _vm.t(\n                      \"photos\",\n                      \"This album does not have any photos or videos yet!\"\n                    ),\n                  },\n                  slot: \"empty-content\",\n                },\n                [\n                  _c(\"ImagePlus\", { attrs: { slot: \"icon\" }, slot: \"icon\" }),\n                  _vm._v(\" \"),\n                  _c(\n                    \"NcButton\",\n                    {\n                      attrs: {\n                        slot: \"action\",\n                        type: \"primary\",\n                        \"aria-label\": _vm.t(\n                          \"photos\",\n                          \"Add photos to this album\"\n                        ),\n                      },\n                      on: {\n                        click: function ($event) {\n                          _vm.showAddPhotosModal = true\n                        },\n                      },\n                      slot: \"action\",\n                    },\n                    [\n                      _c(\"Plus\", { attrs: { slot: \"icon\" }, slot: \"icon\" }),\n                      _vm._v(\n                        \"\\n\\t\\t\\t\\t\" +\n                          _vm._s(_vm.t(\"photos\", \"Add\")) +\n                          \"\\n\\t\\t\\t\"\n                      ),\n                    ],\n                    1\n                  ),\n                ],\n                1\n              ),\n            ],\n            1\n          )\n        : _vm._e(),\n      _vm._v(\" \"),\n      _vm.showAddPhotosModal\n        ? _c(\n            \"NcModal\",\n            {\n              attrs: {\n                size: \"large\",\n                title: _vm.t(\"photos\", \"Add photos to the album\"),\n              },\n              on: {\n                close: function ($event) {\n                  _vm.showAddPhotosModal = false\n                },\n              },\n            },\n            [\n              _c(\"FilesPicker\", {\n                attrs: {\n                  destination: _vm.album.basename,\n                  \"blacklist-ids\": _vm.albumFileIds,\n                  loading: _vm.loadingAddFilesToAlbum,\n                },\n                on: { \"files-picked\": _vm.handleFilesPicked },\n              }),\n            ],\n            1\n          )\n        : _vm._e(),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }"],"names":[],"sourceRoot":""}